import{css as e,LitElement as t,html as o}from"lit";var i=e`:host{display:block}:host{--font-family:monospace;--font-size:12pt;--line-height:14pt;--lines-width:40px;--editor-bg-color:#fff;--editor-text-color:#000;--editor-caret-color:var(--editor-text-color);--editor-sel-color:#b9ecff;--lines-bg-color:#eee;--lines-text-color:#000;--scroll-track-color:#aaa;--scroll-thumb-color:#eee;--hl-color-string:#00ae22;--hl-color-function:#004eff;--hl-color-number:#dd9031;--hl-color-operator:#5a5a5a;--hl-color-class-name:#3cabb6;--hl-color-punctuation:#4a4a4a;--hl-color-keyword:#8500ff;--hl-color-comment:#aaa;--hl-color-tag:#3a9bca;--hl-color-selector:#3a9bca;--hl-color-property:#713aca;height:100%;max-height:inherit;max-width:inherit;width:100%}.litcode{border-radius:inherit;display:grid;font-family:var(--font-family);font-size:var(--font-size);grid-template-columns:var(--lines-width) auto;height:100%;line-height:var(--line-height);max-height:inherit;max-width:inherit;overflow:auto;position:relative}.litcode :is(.litcode_textarea,.litcode_highlight){box-sizing:border-box;grid-column:1/3;grid-row:1;height:100%;height:calc(var(--height) + 100% - var(--line-height)*4);width:100%}.litcode .litcode_linenumbers~:is(.litcode_textarea,.litcode_highlight){grid-column:2;grid-row:1}.litcode :is(.litcode_textarea,.litcode_linenumbers,.litcode_highlight){padding:4px}.litcode .litcode_linenumbers{background-color:var(--lines-bg-color);box-sizing:border-box;color:var(--lines-text-color);height:100%;left:0;padding-right:1px;position:-webkit-sticky;position:sticky;text-align:right;-webkit-user-select:none;-moz-user-select:none;user-select:none}.litcode .litcode_textarea{background-color:var(--editor-bg-color);border:none;caret-color:var(--editor-caret-color);color:transparent;font:inherit;height:100%;margin:0;outline:none;resize:none;white-space:pre}.litcode .litcode_textarea::-moz-selection{background-color:var(--editor-sel-color)}.litcode .litcode_textarea::selection{background-color:var(--editor-sel-color)}.litcode .litcode_highlight{color:var(--editor-text-color);height:100%;pointer-events:none;width:100%}.litcode .litcode_highlight>pre{margin:0}.litcode::-webkit-scrollbar{height:10px;width:10px}.litcode::-webkit-scrollbar-track{background-color:var(--scroll-track-color);border-radius:8px}.litcode::-webkit-scrollbar-thumb{background-color:var(--scroll-thumb-color);border-radius:8px}.litcode::-webkit-scrollbar-corner{background-color:var(--scroll-track-color)}.litcode[default] .token.string{color:var(--hl-color-string)}.litcode[default] .token.function{color:var(--hl-color-function)}.litcode[default] .token.number{color:var(--hl-color-number)}.litcode[default] .token.operator{color:var(--hl-color-operator)}.litcode[default] .token.class-name{color:var(--hl-color-class-name)}.litcode[default] .token.punctuation{color:var(--hl-color-punctuation)}.litcode[default] .token.keyword{color:var(--hl-color-keyword)}.litcode[default] .token.comment{color:var(--hl-color-comment)}.litcode[default] .token.tag{color:var(--hl-color-tag)}.litcode[default] .token.selector{color:var(--hl-color-selector)}.litcode[default] .token.property{color:var(--hl-color-property)}`;const r="undefined"!=typeof Prism;function l(e){return"string"==typeof e?o`${e}`:o`<span class="token ${e.type} ${e.alias}">${Array.isArray(e.content)?e.content.map(l):o`${e.content}`}</span>`}customElements.define("lit-code",class extends t{static get styles(){return i}static get properties(){return{code:{type:String},grammar:{type:Object},language:{type:String},noshadow:{attribute:!0},linenumbers:{attribute:!0}}}get shadowDom(){return!this.hasAttribute("noshadow")}constructor(){super(),this.opening=["(","{","[","'",'"'],this.closing=[")","}","]","'",'"'],this.code="",this.indent="  ",this.language="clike",r&&(this.grammar=Prism.languages[this.language])}update(e){if(super.update(e),r&&e.has("language")){const e=Prism.languages[this.language.toLowerCase()];if(void 0===e)throw new Error("Unsupported Prism language");this.grammar=e}}_getElement(e){return this.shadowDom?this.shadowRoot.querySelector(`.litcode_${e}`):this.querySelector(`.litcode_${e}`)}firstUpdated(){this.elTextarea=this._getElement("textarea"),this.elContainer=this._getElement("litcode"),this.updateTextarea()}render(){return o` ${this.shadowDom?o``:o`<style>${i.cssText}</style>`} <div class="litcode litcode_litcode" ?default="${!this.hasAttribute("mycolors")}"> ${this.hasAttribute("linenumbers")?o` <div class="litcode_linenumbers"> <div class="litcode_line">1</div> ${(this.code.match(/\r?\n/g)||[]).map(((e,t)=>o` <div class="litcode_line">${t+2}</div> `))} </div> `:o``} <textarea class="litcode_textarea" spellcheck="false" @keydown="${this.handleKeys}" @input="${this.handleInput}"></textarea> <code class="litcode_highlight"><pre>${r?Prism.tokenize(this.code,this.grammar).map(l):o`${this.code}`}</pre></code> </div> `}setCode(e){this.code=e,this.updateTextarea()}getCode(){return this.code}createRenderRoot(){return this.shadowDom?super.createRenderRoot():this}setCursor(e){this.elTextarea.setSelectionRange(e,e)}setSelect(e,t){this.elTextarea.setSelectionRange(e,t)}getCurrentLineIndent(){const e=this.elTextarea.selectionStart,t=this.elTextarea.selectionEnd,o=this.code.lastIndexOf("\n",e-1)+1,i=(()=>{let e=o;for(;" "===this.code[e]&&e<t;)e++;return e-o})();return" ".repeat(i)}updateTextarea(){this.elTextarea&&(this.elTextarea.value=this.code,this.dispatchEvent(new CustomEvent("update",{detail:this.code})))}insertCode(e,t,o=!0){this.code=this.code.substring(0,e)+t+this.code.substring(e),this.updateTextarea(),o&&this.setCursor(e+t.length)}replaceCode(e,t,o="",i=!0){this.code=this.code.substring(0,e)+o+this.code.substring(t),this.updateTextarea(),i&&this.setCursor(e+o.length)}handleKeys(e){switch(e.code){case"Tab":this.handleTabs(e);break;case"Enter":this.handleNewLine(e);break;case"Backspace":this.handleBackspace(e);break;default:this.opening.includes(e.key)?this.handleAutoClose(e):this.closing.includes(e.key)&&this.handleAutoSkip(e)}}handleInput({target:e}){this.code=e.value,this.dispatchEvent(new CustomEvent("update",{detail:this.code}))}handleTabs(e){e.preventDefault();const t=this.elTextarea.selectionStart,o=this.elTextarea.selectionEnd;if(t!==o){const i=Math.max(0,this.code.lastIndexOf("\n",t-1)),r=Math.max(this.code.indexOf("\n",o),o);let l=0,s=this.code.substring(i,r),n=this.indent.length;0===i&&(s="\n"+s),e.shiftKey?(n=-n,l=(s.match(new RegExp("\n"+this.indent,"g"))||[]).length,s=s.replaceAll("\n"+this.indent,"\n")):(l=(s.match(/\n/g)||[]).length,s=s.replaceAll("\n","\n"+this.indent)),0===i&&(s=s.replace(/^\n/,"")),this.replaceCode(i,r,s,!1);const a=Math.max(i+1,t+n),c=o+l*n;this.setSelect(a,c)}else this.insertCode(t,this.indent,!0)}handleBackspace(e){const t=this.elTextarea.selectionStart,o=this.elTextarea.selectionEnd;if(e.ctrlKey||t!==o)return;e.preventDefault();const i=this.code[t-1],r=this.code[t],l=this.opening.includes(i)&&this.closing.includes(r),s=this.closing[this.opening.indexOf(i)]===r;if(l&&s)this.replaceCode(t-1,t+1);else{const e=t-this.indent.length,o=t;this.code.substring(e,o)===this.indent?this.replaceCode(e,o):this.replaceCode(t-1,t)}}handleAutoClose(e){const t=this.elTextarea.selectionStart,o=this.elTextarea.selectionEnd;if("'"===this.code[t]||'"'===this.code[t])return this.handleAutoSkip(e);if(e.preventDefault(),t===o){const o=e.key,i=this.closing[this.opening.indexOf(o)];if("{"!==o||"\n"!==this.code[t]&&this.code.length!==t)this.insertCode(t,o+i),this.setCursor(t+1);else{const e="\n"+this.getCurrentLineIndent();this.insertCode(t,o+e+this.indent+e+i),this.setCursor(t+e.length+this.indent.length+1)}}}handleAutoSkip(e){const t=this.elTextarea.selectionStart;this.code[t]===e.key&&(e.preventDefault(),this.setCursor(t+1))}handleNewLine(e){e.preventDefault(),this.insertCode(this.elTextarea.selectionStart,"\n"+this.getCurrentLineIndent()),this.elTextarea.selectionStart===this.code.length&&(this.elContainer.scrollTop=this.elContainer.scrollHeight)}});
